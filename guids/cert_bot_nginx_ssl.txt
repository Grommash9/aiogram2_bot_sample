sudo apt install certbot python3-certbot-nginx

sudo ufw allow 22
sudo ufw allow 'Nginx Full'
sudo ufw delete allow 'Nginx HTTP'
sudo ufw enable
sudo certbot --nginx -d payouts-api.telegram-crm.work
sudo certbot --nginx -d api.web-karovanets.telegram-crm.work
sudo certbot --nginx -d pm-callback.telegram-crm.work

mkdir /etc/nginx/payouts-api
mkdir /etc/nginx/karovanets_web
mkdir /etc/nginx/application-status-changer

nano /etc/nginx/sites-available/default


include /etc/nginx/payouts-api/*.conf;
include /etc/nginx/karovanets_api/*.conf;


gunicorn --bind 0.0.0.0:8000 admin_panel.wsgi


nano /etc/nginx/payouts-api/api.conf
mkdir /var/log/gunicorn
sudo nano /etc/systemd/system/application-status-changer_gunicorn.service



[Unit]
Description=gunicorn daemon
After=network.target

[Service]
User=root
Group=www-data
WorkingDirectory=/home/exchanges_requests_controller/admin_panel
ExecStart=/home/exchanges_requests_controller/env/bin/gunicorn --access-logfile - --workers 3 --bind unix:/var/log/gunicorn/exchanges_requests_controller.sock admin_panel.wsgi:application

[Install]
WantedBy=multi-user.target

nano /etc/nginx/application-status-changer/admin_panel.conf


location /admin {
    include proxy_params;
    proxy_pass http://unix:/var/log/gunicorn/exchanges_requests_controller.sock;
}

location /static {
        root /var/www;
}
